import{defineComponent as be,computed as oe,createElementBlock as P,openBlock as N,createElementVNode as M,withKeys as qe,withModifiers as Le,h as R,toDisplayString as J,unref as B,createCommentVNode as ge,createVNode as U,ref as T,watch as Se,resolveComponent as q,createBlock as X,withCtx as W,Fragment as Ae,renderList as We,normalizeClass as Ye,KeepAlive as Ge}from"vue";import{useStorage as Ze,receive as _e,send as Y,useMenu as Je,useContext as Qe,Schema as Oe,clone as $e,deepEqual as Te,VirtualList as Xe,message as et,icons as tt}from"@koishijs/client";import{useEventListener as je}from"@vueuse/core";var nt=Object.defineProperty,g=(e,t)=>nt(e,"name",{value:t,configurable:true});function rt(){}g(rt,"noop");function I(e){return e==null}g(I,"isNullable");function he(e){return!I(e)}g(he,"isNonNullable");function at(e){return e&&typeof e=="object"&&!Array.isArray(e)}g(at,"isPlainObject");function st(e,t){return Object.fromEntries(Object.entries(e).filter(([a,l])=>t(a,l)))}g(st,"filterKeys");function ot(e,t){return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,t(l,a)]))}g(ot,"mapValues");function it(e,t,a){if(!t)return{...e};const l={};for(const u of t)(a||e[u]!==void 0)&&(l[u]=e[u]);return l}g(it,"pick");function lt(e,t){if(!t)return{...e};const a={...e};for(const l of t)Reflect.deleteProperty(a,l);return a}g(lt,"omit");function ve(e,t,a){return Object.defineProperty(e,t,{writable:true,value:a,enumerable:false})}g(ve,"defineProperty");function ut(e,t){return t.every(a=>e.includes(a))}g(ut,"contain");function ft(e,t){return e.filter(a=>t.includes(a))}g(ft,"intersection");function ct(e,t){return e.filter(a=>!t.includes(a))}g(ct,"difference");function pt(e,t){return Array.from(new Set([...e,...t]))}g(pt,"union");function dt(e){return[...new Set(e)]}g(dt,"deduplicate");function mt(e,t){const a=e==null?void 0:e.indexOf(t);return a>=0?(e.splice(a,1),true):false}g(mt,"remove");function Ne(e){return Array.isArray(e)?e:I(e)?[]:[e]}g(Ne,"makeArray");function F(e,t){return arguments.length===1?a=>F(e,a):e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}g(F,"is");function ne(e){return F("ArrayBuffer",e)||F("SharedArrayBuffer",e)}g(ne,"isArrayBufferLike");function Ve(e){return ne(e)||ArrayBuffer.isView(e)}g(Ve,"isArrayBufferSource");var E;(e=>{e.is=ne,e.isSource=Ve;function t(h){return ArrayBuffer.isView(h)?h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength):h}e.fromSource=t,g(t,"fromSource");function a(h){if(typeof Buffer<"u")return Buffer.from(h).toString("base64");let s="";const f=new Uint8Array(h);for(let c=0;c<f.byteLength;c++)s+=String.fromCharCode(f[c]);return btoa(s)}e.toBase64=a,g(a,"toBase64");function l(h){return typeof Buffer<"u"?t(Buffer.from(h,"base64")):Uint8Array.from(atob(h),s=>s.charCodeAt(0))}e.fromBase64=l,g(l,"fromBase64");function u(h){return typeof Buffer<"u"?Buffer.from(h).toString("hex"):Array.from(new Uint8Array(h),s=>s.toString(16).padStart(2,"0")).join("")}e.toHex=u,g(u,"toHex");function x(h){if(typeof Buffer<"u")return t(Buffer.from(h,"hex"));const s=h.length%2===0?h:h.slice(0,h.length-1),f=[];for(let c=0;c<s.length;c+=2)f.push(parseInt(`${s[c]}${s[c+1]}`,16));return Uint8Array.from(f).buffer}e.fromHex=x,g(x,"fromHex")})(E||(E={}));E.fromBase64;E.toBase64;E.fromHex;E.toHex;function ze(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map(ze);if(F("Date",e))return new Date(e.valueOf());if(F("RegExp",e))return new RegExp(e.source,e.flags);if(ne(e))return e.slice(0);if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);const t=Object.create(Object.getPrototypeOf(e));for(const a of Reflect.ownKeys(e))Reflect.defineProperty(t,a,Reflect.getOwnPropertyDescriptor(e,a));return t}g(ze,"clone");function ye(e,t,a){if(e===t||!a&&I(e)&&I(t))return true;if(typeof e!=typeof t||typeof e!="object"||!e||!t)return false;function l(u,x){return u(e)?u(t)?x(e,t):false:u(t)?false:void 0}return g(l,"check"),l(Array.isArray,(u,x)=>u.length===x.length&&u.every((h,s)=>ye(h,x[s])))??l(F("Date"),(u,x)=>u.valueOf()===x.valueOf())??l(F("RegExp"),(u,x)=>u.source===x.source&&u.flags===x.flags)??l(ne,(u,x)=>{if(u.byteLength!==x.byteLength)return false;const h=new Uint8Array(u),s=new Uint8Array(x);for(let f=0;f<h.length;f++)if(h[f]!==s[f])return false;return true})??Object.keys({...e,...t}).every(u=>ye(e[u],t[u],a))}g(ye,"deepEqual");function gt(e){return e.charAt(0).toUpperCase()+e.slice(1)}g(gt,"capitalize");function xe(e){return e.charAt(0).toLowerCase()+e.slice(1)}g(xe,"uncapitalize");function Ie(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}g(Ie,"camelCase");function Fe(e){return xe(e).replace(/_/g,"-").replace(/.[A-Z]+/g,t=>t[0]+"-"+t.slice(1).toLowerCase())}g(Fe,"paramCase");function ht(e){return xe(e).replace(/-/g,"_").replace(/.[A-Z]+/g,t=>t[0]+"_"+t.slice(1).toLowerCase())}g(ht,"snakeCase");var vt=Ie,yt=Fe;function Re(e){return e.replace(/\/$/,"")}g(Re,"trimSlash");function bt(e){return e.startsWith("/")||(e="/"+e),Re(e)}g(bt,"sanitize");var De;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function a(p){t=p}e.setTimezoneOffset=a,g(a,"setTimezoneOffset");function l(){return t}e.getTimezoneOffset=l,g(l,"getTimezoneOffset");function u(p=new Date,d){return typeof p=="number"&&(p=new Date(p)),d===void 0&&(d=t),Math.floor((p.valueOf()/e.minute-d)/1440)}e.getDateNumber=u,g(u,"getDateNumber");function x(p,d){const m=new Date(p*e.day);return d===void 0&&(d=t),new Date(+m+d*e.minute)}e.fromDateNumber=x,g(x,"fromDateNumber");const h=/\d+(?:\.\d+)?/.source,s=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(p=>`(${h}${p})?`).join("")}$`);function f(p){const d=s.exec(p);return d?(parseFloat(d[1])*e.week||0)+(parseFloat(d[2])*e.day||0)+(parseFloat(d[3])*e.hour||0)+(parseFloat(d[4])*e.minute||0)+(parseFloat(d[5])*e.second||0):0}e.parseTime=f,g(f,"parseTime");function c(p){const d=f(p);return d?p=Date.now()+d:/^\d{1,2}(:\d{1,2}){1,2}$/.test(p)?p=`${new Date().toLocaleDateString()}-${p}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(p)&&(p=`${new Date().getFullYear()}-${p}`),p?new Date(p):new Date}e.parseDate=c,g(c,"parseDate");function O(p){const d=Math.abs(p);return d>=e.day-e.hour/2?Math.round(p/e.day)+"d":d>=e.hour-e.minute/2?Math.round(p/e.hour)+"h":d>=e.minute-e.second/2?Math.round(p/e.minute)+"m":d>=e.second?Math.round(p/e.second)+"s":p+"ms"}e.format=O,g(O,"format");function _(p,d=2){return p.toString().padStart(d,"0")}e.toDigits=_,g(_,"toDigits");function j(p,d=new Date){return p.replace("yyyy",d.getFullYear().toString()).replace("yy",d.getFullYear().toString().slice(2)).replace("MM",_(d.getMonth()+1)).replace("dd",_(d.getDate())).replace("hh",_(d.getHours())).replace("mm",_(d.getMinutes())).replace("ss",_(d.getSeconds())).replace("SSS",_(d.getMilliseconds(),3))}e.template=j,g(j,"template")})(De||(De={}));var _t=Object.defineProperty,xt=Object.getOwnPropertyNames,w=(e,t)=>_t(e,"name",{value:t,configurable:true}),wt=(e,t)=>function(){return t||(0,e[xt(e)[0]])((t={exports:{}}).exports,t),t.exports},kt=wt({"src/index.ts"(e,t){var h;var a=Symbol.for("satori.element"),l=(h=class{get data(){return this.attrs}getTagName(){var f;return this.type==="component"?((f=this.attrs.is)==null?void 0:f.name)??"component":this.type}toAttrString(){return Object.entries(this.attrs).map(([f,c])=>I(c)?"":(f=yt(f),c===true?` ${f}`:c===false?` no-${f}`:` ${f}="${u.escape(""+c,true)}"`)).join("")}toString(f=false){if(this.type==="text"&&"content"in this.attrs)return f?this.attrs.content:u.escape(this.attrs.content);const c=this.children.map(j=>j.toString(f)).join("");if(f)return c;const O=this.toAttrString(),_=this.getTagName();return this.children.length?`<${_}${O}>${c}</${_}>`:`<${_}${O}/>`}},w(h,"ElementConstructor"),h);ve(l,"name","Element"),ve(l.prototype,a,true);function u(s,...f){const c=Object.create(l.prototype),O={},_=[];if(f[0]&&typeof f[0]=="object"&&!u.isElement(f[0])&&!Array.isArray(f[0])){const j=f.shift();for(const[p,d]of Object.entries(j))I(d)||(p==="children"?f.push(...Ne(d)):O[vt(p)]=d)}for(const j of f)_.push(...u.toElementArray(j));return typeof s=="function"&&(O.is=s,s="component"),Object.assign(c,{type:s,attrs:O,children:_})}w(u,"Element");var x=new Function("expr","context",`
  try {
    with (context) {
      return eval(expr)
    }
  } catch {}
`);(s=>{s.jsx=s,s.jsxs=s,s.jsxDEV=s,s.Fragment="template";function f(n){return n&&typeof n=="object"&&n[a]}s.isElement=f,w(f,"isElement");function c(n){if(typeof n=="string"||typeof n=="number"||typeof n=="boolean"){if(n=""+n,n)return s("text",{content:n})}else{if(f(n))return n;if(!I(n))throw new TypeError(`Invalid content: ${n}`)}}s.toElement=c,w(c,"toElement");function O(n){return Array.isArray(n)?n.map(c).filter(he):[c(n)].filter(he)}s.toElementArray=O,w(O,"toElementArray");function _(n,r){return typeof n=="string"?$(n,r):O(n)}s.normalize=_,w(_,"normalize");function j(n,r=false){const o=(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return r?o.replace(/"/g,"&quot;"):o}s.escape=j,w(j,"escape");function p(n){return n.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(r,o)=>o==="38"?r:String.fromCharCode(+o)).replace(/&#x([0-9a-f]+);/gi,(r,o)=>o==="26"?r:String.fromCharCode(parseInt(o,16))).replace(/&(amp|#38|#x26);/g,"&")}s.unescape=p,w(p,"unescape");function d(n,r={}){var i;const o=$(n);return r.caret?r.type&&((i=o[0])==null?void 0:i.type)!==r.type?void 0:o[0]:L(o,r.type||"*")[0]}s.from=d,w(d,"from");const m=/ *([ >+~]) */g;function k(n){return n.split(",").map(r=>{const o=[];r=r.trim();let i,y=" ";for(;i=m.exec(r);)o.push({type:r.slice(0,i.index),combinator:y}),y=i[1],r=r.slice(i.index+i[0].length);return o.push({type:r,combinator:y}),o})}s.parseSelector=k,w(k,"parseSelector");function L(n,r){if(!n||!r)return[];if(typeof n=="string"&&(n=$(n)),typeof r=="string"&&(r=k(r)),!r.length)return[];let o=[];const i=[];for(const[y,b]of n.entries()){const S=[],D=[...r,...o];o=[];let C=false;for(const A of D){const{type:V,combinator:ae}=A[0];(V===b.type||V==="*")&&(A.length===1?C=true:[" ",">"].includes(A[1].combinator)?S.push(A.slice(1)):A[1].combinator==="+"?o.push(A.slice(1)):r.push(A.slice(1))),ae===" "&&S.push(A)}C&&i.push(n[y]),i.push(...L(b.children,S))}return i}s.select=L,w(L,"select");function z(n,r){if(n=n.trim(),!/^[\w.]+$/.test(n))return x(n,r)??"";let o=r;for(const i of n.split("."))if(o=o[i],I(o))return"";return o??""}s.interpolate=z,w(z,"interpolate");const le=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)/,ue=/(?<comment><!--[\s\S]*?-->)|(?<tag><(\/?)([^!\s>/]*)([^>]*?)\s*(\/?)>)|(?<curly>\{(?<derivative>[@:/#][^\s}]*)?[\s\S]*?\})/,fe=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)')?/g,ce=/([^\s=]+)(?:="(?<value1>[^"]*)"|='(?<value2>[^']*)'|=\{(?<curly>[^}]+)\})?/g;let re;(n=>{n[n.OPEN=0]="OPEN",n[n.CLOSE=1]="CLOSE",n[n.EMPTY=2]="EMPTY",n[n.CONTINUE=3]="CONTINUE"})(re||(re={}));function $(n,r){const o=[];function i(C){C&&o.push(C)}w(i,"pushText");const y=r?ue:le;let b,S=true;for(;b=y.exec(n);){const{curly:C,comment:A,derivative:V}=b.groups,ae=!C;D(n.slice(0,b.index),S,ae),S=ae,n=n.slice(b.index+b[0].length);const[Ue,,,Pe,Ee,He,Ke]=b;if(!A){if(C){let ke="",Ce=2;V&&(ke=V.slice(1),Ce={"@":2,"#":0,"/":1,":":3}[V[0]]),o.push({type:"curly",name:ke,position:Ce,source:C,extra:C.slice(1+(V??"").length,-1)});continue}o.push({type:"angle",source:Ue,name:Ee||s.Fragment,position:Pe?1:Ke?2:0,extra:He})}}D(n,S,true);function D(C,A,V){C=p(C),A&&(C=C.replace(/^\s*\n\s*/,"")),V&&(C=C.replace(/\s*\n\s*$/,"")),i(C)}return w(D,"parseContent"),K(H(o),r)}s.parse=$,w($,"parse");function H(n){const r=[[{type:"angle",name:s.Fragment,position:0,source:"",extra:"",children:{default:[]}},"default"]];function o(...i){const[y,b]=r[0];y.children[b].push(...i)}w(o,"pushToken");for(const i of n){if(typeof i=="string"){o(i);continue}const{name:y,position:b}=i;b===1?r[0][0].name===y&&r.shift():b===3?(r[0][0].children[y]=[],r[0][1]=y):b===0?(o(i),i.children={default:[]},r.unshift([i,"default"])):o(i)}return r[r.length-1][0].children.default}w(H,"foldTokens");function K(n,r){const o=[];for(const i of n)if(typeof i=="string")o.push(s("text",{content:i}));else if(i.type==="angle"){const y={},b=r?ce:fe;let S;for(;S=b.exec(i.extra);){const[,D,C,A=C,V]=S;V?y[D]=z(V,r):I(A)?D.startsWith("no-")?y[D.slice(3)]=false:y[D]=true:y[D]=p(A)}o.push(s(i.name,y,i.children&&K(i.children.default,r)))}else if(!i.name)o.push(...O(z(i.extra,r)));else if(i.name==="if")x(i.extra,r)?o.push(...K(i.children.default,r)):o.push(...K(i.children.else||[],r));else if(i.name==="each"){const[y,b]=i.extra.split(/\s+as\s+/),S=z(y,r);if(!S||!S[Symbol.iterator])continue;for(const D of S)o.push(...K(i.children.default,{...r,[b]:D}))}return o}w(K,"parseTokens");function pe(n,r,o){const{type:i,attrs:y,children:b}=n;if(typeof r=="function")return r(n,o);{let S=r[typeof i=="string"?i:""]??r.default??true;return typeof S=="function"&&(S=S(y,b,o)),S}}w(pe,"visit");function de(n,r,o){const i=typeof n=="string"?$(n):n,y=[];return i.forEach(b=>{const{type:S,attrs:D,children:C}=b,A=pe(b,r,o);A===true?y.push(s(S,D,de(C,r,o))):A!==false&&y.push(...O(A))}),typeof n=="string"?y.join(""):y}s.transform=de,w(de,"transform");async function me(n,r,o){const i=typeof n=="string"?$(n):n,y=(await Promise.all(i.map(async b=>{const{type:S,attrs:D,children:C}=b,A=await pe(b,r,o);return A===true?[s(S,D,await me(C,r,o))]:A!==false?O(A):[]}))).flat(1);return typeof n=="string"?y.join(""):y}s.transformAsync=me,w(me,"transformAsync");function Q(n,...r){return(...o)=>{const i=s(n);return r.forEach((y,b)=>{I(o[b])||(i.attrs[y]=o[b])}),o[r.length]&&Object.assign(i.attrs,o[r.length]),i}}w(Q,"createFactory"),s.warn=w(()=>{},"warn");function G(n){return(r,...o)=>{let i="base64://";return typeof o[0]=="string"&&(i=`data:${o.shift()};base64,`),F("Buffer",r)?r=i+r.toString("base64"):F("ArrayBuffer",r)?r=i+E.toBase64(r):ArrayBuffer.isView(r)&&(r=i+E.toBase64(r.buffer)),r.startsWith("base64://")&&(0,s.warn)('protocol "base64:" is deprecated and will be removed in the future, please use "data:" instead'),s(n,{...o[0],src:r})}}w(G,"createAssetFactory"),s.text=Q("text","content"),s.at=Q("at","id"),s.sharp=Q("sharp","id"),s.quote=Q("quote","id"),s.image=G("img"),s.img=G("img"),s.video=G("video"),s.audio=G("audio"),s.file=G("file");function we(n,r){return s("i18n",typeof n=="string"?{path:n}:n,r)}s.i18n=we,w(we,"i18n")})(u||(u={})),t.exports=u}});const te=kt(),Ct={class:"textarea"},St=["value","placeholder","onKeydown"],At=be({__name:"input",props:{target:{default:()=>document},modelValue:{default:""},placeholder:{}},emits:["send","update:modelValue"],setup(e,{emit:t}){const a=t,l=e,u=oe({get:()=>l.modelValue,set:c=>a("update:modelValue",c)});function x(){u.value&&(a("send",te.escape(u.value)),u.value="")}function h(c){u.value=c.target.value}function s(c,O){if(O)for(const _ of O.items){if(_.kind!=="file")continue;const j=_.getAsFile();if(!j)continue;c.preventDefault();const[p]=j.type.split("/",1);if(!["image","audio","video"].includes(p)){console.warn("Unsupported file type:",j.type);return}const d=new FileReader;d.addEventListener("load",function(){a("send",te(p==="image"?"img":p,{src:d.result}).toString())},false),d.readAsDataURL(j)}}je(l.target,"drop",c=>{s(c,c.dataTransfer)}),je(l.target,"dragover",c=>{c.preventDefault()});async function f(c){s(c,c.clipboardData)}return(c,O)=>(N(),P("div",Ct,[M("input",{autocomplete:"off",step:"any",value:u.value,placeholder:c.placeholder,onInput:h,onPaste:f,onKeydown:qe(Le(x,["stop"]),["enter"])},null,40,St)]))}}),ie=(e,t)=>{const a=e.__vccOpts||e;for(const[l,u]of t)a[l]=u;return a},Ot=ie(At,[["__scopeId","data-v-60f4d521"]]),$t=["b","strong","i","em","u","ins","s","del","code"],ee=(e,t)=>e.map(({type:a,attrs:l,children:u})=>a==="text"?l.content:a==="at"?R("span",`@${l.name}`):a==="img"?R("img",{src:l.src,alt:l.alt}):a==="audio"?R("audio",{src:l.src,controls:true}):a==="video"?R("video",{src:l.src,controls:true}):$t.includes(a)?R(a,ee(u)):a==="spl"?R("span",{class:"spoiler"},ee(u)):a==="p"||a==="message"?R("p",ee(u)):a==="iframe"?R("iframe",{innerHTML:l.content}):ee(u)),jt={name:"message-content",props:{content:{type:String,required:true}},setup(e,t){return()=>R("div",{class:"message-content"},ee(te.parse(e.content)))}},Be=ie(jt,[["__scopeId","data-v-f996f5a6"]]),Dt={private:"私聊模式",guild:"群聊模式",profile:"用户设置"},v=Ze("sandbox",1.1,()=>({platform:"sandbox:"+Math.random().toString(36).slice(2),user:"",index:0,messages:{},panelType:"private"})),Z=oe(()=>v.value.panelType==="guild"?"#":"@"+v.value.user);_e("sandbox/message",e=>{var t,a;e.platform===v.value.platform&&((t=v.value.messages)[a=e.channel]||(t[a]=[])).push(e)});_e("sandbox/clear",()=>{v.value.messages[Z.value]=[]});const se={deleteMessage({messageId:e,channelId:t}){const a=v.value.messages[t];a&&(v.value.messages[t]=a.filter(l=>l.id!==e))},getMessage({messageId:e,channelId:t}){var a;return(a=v.value.messages[t])==null?void 0:a.find(l=>l.id===e)},getChannel({channelId:e,guildId:t}){return{channelId:"#"}},getChannelList({guildId:e}){return{data:{channelId:"#"}}},getGuild({guildId:e}){return{guildId:"#"}},getGuildList(){return{data:{guildId:"#"}}},getGuildMember({guildId:e,userId:t}){return{userId:t,username:t}},getGuildMemberList({guildId:e}){return{data:Object.keys(v.value.messages).filter(a=>a.startsWith("@")).map(a=>{const l=a.slice(1);return{userId:l,username:l}})}}};_e("sandbox/request",({method:e,nonce:t,data:a})=>{var u;const l=(u=se[e])==null?void 0:u.call(se,a);Y("sandbox/response",t,l)});const Bt=["Alice","Bob","Carol","Dave","Eve","Frank","Grace","Hank","Ivy","Jack","Kathy","Lily","Mandy","Nancy","Oscar","Peggy","Quinn","Randy","Sandy","Toby","Uma","Vicky","Wendy","Xander","Yvonne","Zoe"],Mt={class:"chat-message"},Lt={class:"avatar"},Nt={class:"nickname"},Vt={key:0,class:"quote"},zt={class:"abstract"},It=be({__name:"message",props:{data:{}},setup(e){const t=Je("sandbox.message");return(a,l)=>(N(),P("div",Mt,[M("div",Lt,J(a.data.user[0]),1),M("div",Nt,J(a.data.user),1),M("div",{class:"message-box",onContextmenu:l[0]||(l[0]=Le(u=>B(t)(u,a.data),["stop"]))},[a.data.quote?(N(),P("blockquote",Vt,[M("span",zt,[U(B(Be),{content:a.data.quote.content},null,8,["content"])])])):ge("v-if",true),U(B(Be),{content:a.data.content},null,8,["content"])],32)]))}}),Ft=ie(It,[["__scopeId","data-v-4057f070"]]),Rt={class:"user-container"},Ut={class:"avatar"},Pt={class:"nick"},Et=["onClick"],Ht={class:"card-header"},Kt=["onClick"],qt={class:"card-footer"},Wt={key:0,class:"quote"},Yt={class:"left"},Me=10,Gt=be({__name:"layout",setup(e){const t=Qe();t.action("sandbox.message.delete",{action:({sandbox:m})=>d(m.message)}),t.action("sandbox.message.quote",{action:({sandbox:m})=>c.value=m.message});const a=Oe.object({authority:Oe.natural().description("权限等级")}),l=oe(()=>Object.keys(v.value.messages).filter(m=>m.startsWith("@")).map(m=>m.slice(1))),u=oe(()=>Object.fromEntries(l.value.map(m=>[m,{name:m}])));function x(){if(l.value.length>=Me)return et.error("可创建的用户数量已达上限。");let m;do m=Bt[v.value.index++],v.value.index%=Me;while(l.value.includes(m));v.value.user=m,v.value.messages["@"+m]=[],Y("sandbox/set-user",v.value.platform,v.value.user,{})}function h(m){const k=l.value.indexOf(m);delete v.value.messages["@"+m],Y("sandbox/set-user",v.value.platform,v.value.user,null),v.value.user===m&&(v.value.user=l.value[k]||"")}const s=T(""),f=T(0),c=T();function O(m){if(m.key==="ArrowUp"){const k=v.value.messages[Z.value].filter(z=>z.user===v.value.user);let L=k.length-f.value;k[L-1]&&(f.value++,s.value=te.unescape(k[L-1].content))}else if(m.key==="ArrowDown"){const k=v.value.messages[Z.value].filter(z=>z.user===v.value.user);let L=k.length-f.value;k[L+1]?(f.value--,s.value=te.unescape(k[L+1].content)):f.value&&(f.value=0,s.value="")}}const _=T(),j=T();Se(()=>v.value.user,async m=>{m&&(_.value=await Y("sandbox/get-user",v.value.platform,v.value.user),j.value=$e(_.value))},{immediate:true}),Se(j,async m=>{Te(m,_.value)||(await Y("sandbox/set-user",v.value.platform,v.value.user,m),_.value=$e(m))},{deep:true});function p(m){f.value=0,Y("sandbox/send-message",v.value.platform,v.value.user,Z.value,m,c.value),c.value=null}async function d(m){await Y("sandbox/delete-message",m.platform,m.user,m.channel,m.id),se.deleteMessage({messageId:m.id,channelId:m.channel})}return(m,k)=>{const L=q("k-icon"),z=q("k-tab-group"),le=q("el-scrollbar"),ue=q("k-empty"),fe=q("k-form"),ce=q("k-content"),re=q("k-layout");return N(),X(re,{class:"page-sandbox"},{left:W(()=>[M("div",{class:"card-header k-tab-menu-item",onClick:x},"添加用户"),M("div",Rt,[U(le,null,{default:W(()=>[U(z,{data:u.value,modelValue:B(v).user,"onUpdate:modelValue":k[0]||(k[0]=$=>B(v).user=$)},{default:W(({name:$})=>[M("div",Ut,J($[0]),1),M("div",Pt,J($),1),M("div",{class:"close",onClick:H=>h($)},[U(L,{name:"times-full"})],8,Et)]),_:1},8,["data","modelValue"])]),_:1})])]),default:W(()=>[M("div",Ht,[(N(true),P(Ae,null,We(B(Dt),($,H)=>(N(),P("span",{key:H,class:Ye(["k-horizontal-tab-item",{active:B(v).panelType===H}]),onClick:K=>B(v).panelType=H},J($),11,Kt))),128))]),(N(),X(Ge,null,[l.value.length?B(v).panelType==="profile"?(N(),X(ce,{key:"profile"+B(Z)},{default:W(()=>[_.value?(N(),X(fe,{key:0,initial:_.value,modelValue:j.value,"onUpdate:modelValue":k[1]||(k[1]=$=>j.value=$),schema:B(a),"show-header":false},null,8,["initial","modelValue","schema"])):ge("v-if",true)]),_:1})):(N(),P(Ae,{key:2},[U(B(Xe),{data:B(v).messages[B(Z)]||[],pinned:""},{default:W($=>[U(Ft,{data:$},null,8,["data"])]),_:1},8,["data"]),M("div",qt,[c.value?(N(),P("div",Wt,[M("span",Yt,"正在回复 @"+J(c.value.user),1),U(L,{name:"times-full",onClick:k[2]||(k[2]=$=>c.value=null)})])):ge("v-if",true),U(B(Ot),{modelValue:s.value,"onUpdate:modelValue":k[3]||(k[3]=$=>s.value=$),onSend:p,onKeydown:O,placeholder:"发送消息到沙盒"},null,8,["modelValue"])])],64)):(N(),X(ue,{key:"empty"},{default:W(()=>k[4]||(k[4]=[M("div",null,"点击「添加用户」开始体验",-1)])),_:1,__:[4]}))],1024))]),_:1})}}}),Zt={},Jt={class:"k-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"};function Qt(e,t){return N(),P("svg",Jt,t[0]||(t[0]=[M("path",{fill:"currentColor",d:"M437.2 403.5L319.1 215l.0001-135C319.1 71.16 312.8 64 303.1 64S288 71.16 288 79.1L287.1 215c0 5.973 1.672 11.83 4.826 16.9L347.6 320H100.4l54.79-88.1C158.3 226.8 160 220.1 160 215L160 79.1C160 71.16 152.8 64 144 64S128 71.16 128 79.1L128 215l-117.2 188.5C-18.48 450.6 15.27 512 70.89 512h306.2C432.7 512 466.5 450.5 437.2 403.5zM410.9 460C407.6 466 397.6 480 377.1 480H70.89c-20.51 0-30.48-13.95-33.82-19.95c-7.025-12.63-6.691-27.46 .873-39.65L80.48 352h287l42.55 68.41C417.6 432.6 417.1 447.4 410.9 460zM112 32h224C344.8 32 352 24.84 352 16S344.8 0 336 0h-224C103.2 0 96 7.156 96 16S103.2 32 112 32z"},null,-1)]))}const Tt=ie(Zt,[["render",Qt]]);tt.register("activity:flask",Tt);const nn=e=>{e.page({name:"沙盒",path:"/sandbox",icon:"activity:flask",order:300,authority:4,component:Gt}),e.menu("sandbox.message",[{id:".delete",label:"删除消息"},{id:".quote",label:"引用回复"}])};export{nn as default};
